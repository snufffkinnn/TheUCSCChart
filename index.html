<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>The Web</title>
<script src="https://d3js.org/d3.v7.min.js"></script>

<style>

html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  font-family: Arial;
}

svg {
  width: 100vw;
  height: 100vh;
  display: block;
  cursor: grab;
}

svg:active {
  cursor: grabbing;
}

.ui {
  position: absolute;
  top: 15px;
  left: 15px;
  z-index: 10;
}

/* ===== Search ===== */

.searchWrapper {
  position: relative;
  margin-bottom: 6px;
}

input {
  padding: 6px 10px;
  border-radius: 4px;
  border: 1px solid #ccc;
  width: 180px;
}

.suggestions {
  position: absolute;
  top: 32px;
  left: 0;
  background: white;
  border: 1px solid #ccc;
  border-radius: 4px;
  width: 180px;
  max-height: 160px;
  overflow-y: auto;
  display: none;
}

.suggestionItem {
  padding: 6px 8px;
  cursor: pointer;
}

.suggestionItem:hover {
  background: #eee;
}

button {
  margin-top: 5px;
  padding: 6px 10px;
  border: none;
  background: black;
  color: white;
  cursor: pointer;
  border-radius: 4px;
}

.title {
  font-size: 22px;
  font-weight: bold;
  margin-bottom: 8px;
}

/* ===== Legend ===== */

.legend {
  margin-top: 10px;
  background: white;
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 8px;
  width: 180px;
}

.legendTitle {
  font-weight: bold;
  margin-bottom: 6px;
  font-size: 13px;
}

.legendItem {
  display: flex;
  align-items: center;
  margin-bottom: 4px;
  font-size: 12px;
}

.legendColor {
  width: 18px;
  height: 3px;
  margin-right: 8px;
  border-radius: 2px;
}

.minimap {
  position: absolute;
  bottom: 20px;
  right: 20px;
  width: 180px;
  height: 120px;
  border: 1px solid black;
  background: white;
}

/* ===== Tooltip ===== */

.tooltip {
  position: absolute;
  padding: 6px 10px;
  background: rgba(0,0,0,0.85);
  color: white;
  font-size: 12px;
  border-radius: 4px;
  pointer-events: none;
  opacity: 0;
}

</style>
</head>

<body>

<div class="ui">
  <div class="title">The Web</div>

  <div class="searchWrapper">
    <input id="searchInput" placeholder="Search person..." />
    <div class="suggestions" id="suggestions"></div>
  </div>

  <button id="resetBtn">Reset View</button>
  <button id="fitBtn">Zoom To Fit</button>
  <button id="fullscreenBtn">Fullscreen</button>

  <!-- ===== Legend Container ===== -->
  <div class="legend" id="legendBox">
    <div class="legendTitle">Relationship Types</div>
  </div>

</div>

<div class="tooltip"></div>

<svg></svg>
<svg class="minimap"></svg>

<script>

const svg = d3.select("svg");
const minimapSVG = d3.select(".minimap");
const tooltip = d3.select(".tooltip");

const searchInput = d3.select("#searchInput");
const suggestionsBox = d3.select("#suggestions");

const width = window.innerWidth;
const height = window.innerHeight;

const container = svg.append("g");

/* ===== Zoom ===== */

const zoom = d3.zoom()
  .scaleExtent([0.2, 5])
  .on("zoom", (event) => {
    container.attr("transform", event.transform);
    updateMiniMap(event.transform);
  });

svg.call(zoom);

/* ===== Data URLs ===== */

const nodesURL = "YOUR NODES URL";
const edgesURL = "YOUR EDGES URL";

/* ===== Colors ===== */

const colors = {
  Kissed: "green",
  Hookup: "red",
  Relationship: "blue",
  Ex: "yellow",
  Situationship: "purple"
};

Promise.all([
  d3.csv(nodesURL),
  d3.csv(edgesURL)
]).then(([nodes, links]) => {

let selectedNode = null;

/* ===== Legend Generation ===== */

const legendData = Object.entries(colors);

const legendBox = d3.select("#legendBox");

legendBox.selectAll(".legendItem")
  .data(legendData)
  .enter()
  .append("div")
  .attr("class", "legendItem")
  .each(function(d){

    const item = d3.select(this);

    item.append("div")
      .attr("class","legendColor")
      .style("background", d[1]);

    item.append("span")
      .text(d[0]);
  });

/* ===== Connection Lookup ===== */

const linkedByIndex = {};

links.forEach(d => {
  linkedByIndex[`${d.source},${d.target}`] = true;
  linkedByIndex[`${d.target},${d.source}`] = true;
});

function isConnected(a, b) {
  return linkedByIndex[`${a.id},${b.id}`] || a.id === b.id;
}

/* ===== Force Simulation ===== */

const simulation = d3.forceSimulation(nodes)
  .force("link", d3.forceLink(links).id(d => d.id).distance(120))
  .force("charge", d3.forceManyBody().strength(-200))
  .force("center", d3.forceCenter(width/2, height/2));

/* ===== Links ===== */

const link = container.selectAll("line")
  .data(links)
  .enter()
  .append("line")
  .attr("stroke", d => colors[d.type])
  .attr("stroke-width", 2)
  .attr("opacity", 0.7);

/* ===== Nodes ===== */

const node = container.selectAll("circle")
  .data(nodes)
  .enter()
  .append("circle")
  .attr("r", 8)
  .attr("fill", "black");

/* ===== Labels ===== */

const label = container.selectAll("text")
  .data(nodes)
  .enter()
  .append("text")
  .text(d => d.id)
  .attr("font-size", 11)
  .attr("dx", 10)
  .attr("dy", 4);

simulation.on("tick", () => {

  link
    .attr("x1", d => d.source.x)
    .attr("y1", d => d.source.y)
    .attr("x2", d => d.target.x)
    .attr("y2", d => d.target.y);

  node.attr("cx", d => d.x).attr("cy", d => d.y);
  label.attr("x", d => d.x).attr("y", d => d.y);

  drawMiniMap(nodes, links);
});

/* ===== Mini Map ===== */

function drawMiniMap(nodes,links){

  minimapSVG.selectAll("*").remove();

  const scale = 0.15;

  const mini = minimapSVG.append("g")
    .attr("transform",`scale(${scale})`);

  mini.selectAll("line")
    .data(links)
    .enter()
    .append("line")
    .attr("x1",d=>d.source.x)
    .attr("y1",d=>d.source.y)
    .attr("x2",d=>d.target.x)
    .attr("y2",d=>d.target.y)
    .attr("stroke","#aaa");

  mini.selectAll("circle")
    .data(nodes)
    .enter()
    .append("circle")
    .attr("cx",d=>d.x)
    .attr("cy",d=>d.y)
    .attr("r",3)
    .attr("fill","black");
}

function updateMiniMap(transform){

  minimapSVG.selectAll("rect.viewport").remove();

  const scale = 0.15;

  minimapSVG.append("rect")
    .attr("class","viewport")
    .attr("x",-transform.x*scale/transform.k)
    .attr("y",-transform.y*scale/transform.k)
    .attr("width", width*scale/transform.k)
    .attr("height", height*scale/transform.k)
    .attr("fill","none")
    .attr("stroke","red");
}

});

</script>
</body>
</html>